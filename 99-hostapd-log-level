#!/bin/sh
# /etc/hotplug.d/net/99-hostapd-log-level

LOG_LEVEL="ERROR"
TAG="hotplug-net"

# Esegui solo su add di device
[ "$ACTION" != "add" ] && exit 0

# Deve esistere il nome del device
[ -z "$DEVICENAME" ] && exit 0

# Controlla se hostapd_cli Ã¨ disponibile
if ! command -v hostapd_cli >/dev/null 2>&1; then
    logger -t "$TAG" -p user.err "hostapd_cli non trovato! Impossibile impostare log_level per $DEVICENAME"
    exit 0
fi

# Verifica che DEVICENAME sia una interfaccia Wi-Fi
WIFI_DEV=0
for d in /sys/class/ieee80211/*/device/net/"$DEVICENAME"; do
    [ -e "$d" ] && WIFI_DEV=1
done

[ "$WIFI_DEV" -eq 0 ] && exit 0

# Imposta il livello di log di hostapd
if hostapd_cli -i "$DEVICENAME" log_level "$LOG_LEVEL" >/dev/null 2>&1; then
    logger -t "$TAG" -p user.info "Device [$DEVICENAME]: hostapd log level impostato su $LOG_LEVEL"
fi

exit 0
